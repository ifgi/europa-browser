<!DOCTYPE html>
<html>
	<!--
	********************************************************************************
	Adapted from:
	http://bl.ocks.org/mbostock/1153292
	********************************************************************************
	-->
	<head>
		<meta http-equiv="Content-type" content="text/html; charset=utf-8">
		<title>LOD GRAPH BROWSER</title>
		
		<link rel="stylesheet" type="text/css" href="./css/lodnet.css">
		<script type="text/javascript" src="./js/d3v3/d3.v3.js"></script>
		<script type="text/javascript" src="./js/lodnet/Util.js"></script>
		<script type="text/javascript" src="./js/lodnet/Lodnet.js"></script>
		
	</head>

	<body>
		<script type="text/javascript">
			
			//Default values
			var endpointUrl = "http://giv-siidemo.uni-muenster.de:8081/parliament/sparql";//var endpointUrl = "http://DBpedia.org/sparql";//
			var graphUri = "file:///C:/Parliament/test";//var graphUri = "http://dbpedia.org";//
			var subject = "http://ifgi.uni-muenster.de/hydrolod#Bad_Essen_31010030";//"http://ifgi.uni-muenster.de/hydrolod#Nalje_Siel_126001";//var subject = "http://ifgi.uni-muenster.de/hydrolod#OBSERVATION_id385178";//var subject = "http://dbpedia.org/resource/Sof%C3%ADa_Vergara";//
			var query = "SELECT DISTINCT * WHERE { GRAPH<" + graphUri + ">{<" + subject + "> ?p ?o}} LIMIT 20"; //var query = "SELECT DISTINCT * FROM <"+ graphUri +"> WHERE {<" + subject + "> ?p ?o} LIMIT 20";//
			var separator = ": ";
			
			
endpoint=http%3A%2F%2Fgiv-siidemo.uni-muenster.de%3A8081%2Fparliament%2Fsparql&graph=file%3A%2F%2F%2FC%3A%2FParliament%2Ftest&subject=http%3A%2F%2Fifgi.uni-muenster.de%2Fhydrolod%23Bad_Essen_31010030
			
			
			
			//Get the parameters from the URL
			if(getURLParameter("endpoint") != null){
				endpointUrl = getURLParameter("endpoint");
			}
			if(getURLParameter("graph") != null){
				graphUri = getURLParameter("graph");
			}
			if(getURLParameter("subject") != null){
				subject = getURLParameter("subject");
			}
			if(getURLParameter("query") != null){
				subject = getURLParameter("query");
			}

			//Retrieves the LOD
			var links = queryMask(subject, query, endpointUrl, graphUri, separator);
			
			//Canvas size
			var w = 960;
			var h = 500;
			//Builds the canvas
			var svg = d3.select("body").append("svg:svg")
				.attr("width", w)
				.attr("height", h);


			// Compute the distinct nodes from the links.
			//Fill the "nodes" object. It takes the triples subjects and predicates, build js objects with them and put them into nodes
			var nodes = {};
			links.forEach(function(link) {
				link.source = nodes[link.source] || (nodes[link.source] = {name: link.source});
				link.target = nodes[link.target] || (nodes[link.target] = {name: link.target});
			});

			//Animation
			var force = d3.layout.force()
				.nodes(d3.values(nodes))
				.links(links)
				.size([w, h])
				.linkDistance(150)
				.charge(-300)
				.on("tick", tick)
				.start();

			//Sets up Arrow heads
			svg.append("svg:defs").selectAll("marker")
				.data(["unknown"])
				.enter().append("svg:marker")
				.attr("id", String)
				.attr("viewBox", "0 -5 10 10")
				.attr("refX", 15)
				.attr("refY", -1.5)
				.attr("markerWidth", 6)
				.attr("markerHeight", 6)
				.attr("orient", "auto")
				.append("svg:path")
				.attr("d", "M0,-5L10,0L0,5");

			//Creates the SVG paths
			var path = svg.append("svg:g").selectAll("path")
				.data(force.links())
				.enter().append("svg:path")
				.attr("class", function(d) { return "link " + d.type; })
				.attr("marker-end", function(d) { return "url(#unknown)"; });//Notice the marker-end points to the arrow head "#unknown" ceated above

	
			var circle = svg.append("svg:g").selectAll("circle")
				.data(force.nodes())
				.enter().append("svg:circle")
				.attr("r", 6)
				.call(force.drag);

				
			//Text for the subject and object
			var text = svg.append("svg:g").selectAll("g")
				.data(force.nodes())
				.enter().append("svg:g");
			text.append("svg:text")
				.attr("x", 8)
				.attr("y", ".31em")
				.attr("class", "shadow")
				.text(function(d) { return d.name; });
			// A copy of the text with a thick white stroke for legibility.
			text.append("svg:text")
				.attr("x", 8)
				.attr("y", ".31em")
				.text(function(d) { return d.name; });

				
				
				
				


				
		</script>
	</body>
</html>
